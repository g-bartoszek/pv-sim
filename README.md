# pv-sim
Simple PV panel simulator

# Components

## Meter

Emits random power consumption values as RabbitMQ messages

Path: `src/meter/app.py`

Parameters:
* `-s START, --start START` - Start date and time in format: "YYYY-MM-DD HH:mm:ss" (default: 2021-01-01 00:00:00)
* `-e END, --end END` - End date and time in format: "YYYY-MM-DD HH:mm:ss" )default: 2021-01-02 00:00:00)
* `-i INTERVAL, --interval INTERVAL` - Interval between measurements in format: "HH:mm:ss" (default: 00:01:00) 
* `-r, --realtime`  - If set measurements are generated in real time (there is a delay), if not, as fast as possible (default: false)
* `--host HOST` - RabbitMQ broker address (default: localhost)

## PV sim

Collects power usage generated by Meter, generates simulated PV power value for a PV panel with arbitrary characteristics and location, sums both values and writes them to the output file.

Path: `src/pv_sim/app.py`

Parameters:
* `--host HOST` - RabbitMQ broker address (default: localhost)
* `-o OUTPUT, --output OUTPUT` - Path to output file (default: `/tmp/output`)

## Instructions

### Prerequisites
* Python (tested on 3.8 and 3.9)
* pip (to install requirements)
* docker (to run RabbitMQ broker in a container)

### Running the apps

1. Install requirements ([venv](https://docs.python.org/3/library/venv.html) may be useful here)

`pip install -r requirements.txt`

2. Start RabbitMQ broker:

`docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3.9-management`

3. (in a separate terminal) Run PV sim:

`src/pv_sim/app.py -o test_output`

4. (in a separate terminal)

`python src/meter/app.py -s "2020-01-01 00:00:00" -e "2020-01-02 00:00:00" -i 00:00:10`

### Running tests

1. Install requirements ([venv](https://docs.python.org/3/library/venv.html) may be useful here)

`pip install -r requirements.txt`

2. Start RabbitMQ broker:

`docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3.9-management`

3. (in a separate terminal) Run pytest:

`pytest`

### CI

CI pipeline runs both of the above and saves example output as an artifact so it may be not necessary to run it locally.